// Generated by CoffeeScript 1.12.7
(function() {
  $(function() {
    var load_start, members_json, roomId, rooms_info;
    $("#hotpoor_shares_qrcode_weixin_area").remove();
    $("#hotpoor_shares").css({
      "position": "relative",
      "paddingBottom": "0px",
      "height": "100%"
    });
    $("#hotpoor_shares").append("<style>\n    .comments_area{\n        width:100%;\n        height:calc(100% - 44px);\n        overflow-y: auto;\n    }\n    .comments_area_tools{\n        width:100%;\n        height:44px;\n        background-color:#f2f2f2;\n        border-top:1px solid #d4d4d4;\n        position:relative;\n    }\n    .comment_content{\n        width: calc(100% - 82px);\n        border-radius: 4px;\n        border: 1px solid #c3c3c3;\n        resize: none;\n        position: absolute;\n        left: 4px;\n        top: 3px;\n        font-size: 14px;\n        padding: 4px;\n        height: 26px;\n    }\n    .comment_submit{\n        width: 60px;\n        height: 30px;\n        font-size: 15px;\n        color: #999999;\n        border-radius: 7px;\n        border: 1px solid #c3c3c3;\n        background-color: #f2f2f2;\n        position: absolute;\n        right: 4px;\n        top: 5px;\n        padding-left: 2px;\n        padding-right: 2px;\n    }\n</style>");
    $("#hotpoor_shares").append("<div class=\"comments_area\">\n</div>\n<div class=\"comments_area_tools\">\n    <textarea class=\"comment_content\"></textarea><button class=\"comment_submit\">发送</button>\n</div>");
    $("#hotpoor_shares").on("touchstart", ".comments_area", function(e) {
      var el_now, scrollTop;
      el_now = this;
      scrollTop = el_now.scrollTop;
      if (scrollTop === 0) {
        el_now.scrollTop = 1;
      }
      if (el_now.scrollTop + el_now.offsetHeight === el_now.scrollHeight) {
        return el_now.scrollTop = parseInt(el_now.scrollHeight) - parseInt(el_now.offsetHeight) - 1;
      }
    });
    roomId = "0cd8429c1da249b6935d7eef72d7fc0b";
    rooms_info = {};
    members_json = {};
    load_start = function() {
      $(".comments_area").empty();
      return $.ajax({
        url: 'http://www.hotpoor.org/api/comment/load',
        type: 'POST',
        dataType: 'json',
        data: {
          app: 'bangfer',
          aim_id: roomId,
          comment_id: rooms_info[roomId].last_comment_id
        },
        success: function(data) {
          var _msg, comment, comments, i, len, members_json_new, members_json_now, results;
          console.log(data);
          if (data.info === "ok") {
            rooms_info[roomId].last_comment_id = data.last_comment_id;
            members_json_now = members_json;
            members_json_new = data.members;
            members_json = $.extend({}, members_json_now, members_json_new);
            comments = data.comments;
            results = [];
            for (i = 0, len = comments.length; i < len; i++) {
              comment = comments[i];
              _msg = [
                comment[3], {
                  "content": comment[4],
                  "nickname": members_json[comment[1]].nickname,
                  "headimgurl": members_json[comment[1]].headimgurl,
                  "time": comment[2],
                  "user_id": comment[1],
                  "tel": members_json[comment[1]].tel,
                  "plus": comment[5],
                  "sequence": comment[0],
                  "comment_id": data.comment_id
                }, roomId
              ];
              results.push(console.log(_msg));
            }
            return results;
          }
        },
        error: function(error) {
          return console.log(error);
        }
      });
    };
    return load_start();
  });

}).call(this);
